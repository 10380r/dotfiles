from smtplib import SMTP
from email.mime.text import MIMEText


def create_message(html):
    msg = MIMEText(html, 'html')
    return msg


def send_message(from_addr, to_addrs, password, msg):
    with SMTP(host="smtp.gmail.com", port=587) as smtp:
        smtp.starttls() # tls通信を開始させる
        smtp.login(
                user = from_addr,
                password = password,
                )
        smtp.send_message(
                from_addr = from_addr,
                to_addrs = to_addrs,
                msg = msg,
                )

def main():

    # TODO JSONを読み込む（予定）
    # TODO スプレッドシートのurlを貼ったら親切
    from_addr = 'dotpro.mein@gmail.com'
    to_addrs  = 'to@example.com'
    password  = '' 
    subject   = '問い合わせがありました'
    html = '<html><body><h1>LPより問い合わせがありました。</h1></body></html>'

     msg = create_message(html)
    # to_addrsはリストであることを想定しているが、リストでなかった場合にリストに変換
    if type(to_addrs) is not list:
        to_addrs = [to_addrs]
    # RFCに則り、カンマ区切りで複数人へのメール送信が可能
    msg['To'] = ','.join(to_addrs) 
    msg['Subject'] = subject
    send_message(from_addr, to_addrs, password, msg)


if __name__ == '__main__':
    main()
